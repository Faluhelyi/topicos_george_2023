---
title: "Theming with bslib and thematic"
output:
  pdf_document: default
  html_document:
    code_folding: show
    theme:
      bg: '#202123'
      fg: '#B8BCC2'
      primary: '#EA80FC'
      secondary: '#00DAC6'
      base_font:
        google: Prompt
      heading_font:
        google: Proza Libre
---

```{r setup, include=FALSE}
if (requireNamespace("thematic")) 
  thematic::thematic_rmd(font = "auto")
```

# Exercício para entrega 5

## Parte 1

```{r include=FALSE}
#setwd("C:/Users/u00378/Desktop/topicos_george_2023/lista5")
library(readxl)
library(purrr)
library(dplyr)
library(ggplot2)
library(zoo)
library(forecast)

predicao = vector(length = 120)
for (i in 1:120) {
  caminho_base <- "C:/Users/u00378/Desktop/topicos_george_2023/lista5/BaseDados.xlsx"
  ## Obter os nomes das abas
  abas <- excel_sheets(caminho_base)
  ## Ler as abas e armazenar em uma lista
  dados_abas <- map(abas, ~read_excel(caminho_base, sheet = .x))
  ## Realizar o join com base no índice (primeira coluna)
  dados_combinados <- reduce(dados_abas, left_join, by = '...1')
  ## data wrangling
  dados_combinados <- data.frame(dados_combinados, row.names = dados_combinados$...1)
  dados_combinados <- dados_combinados[, -1]
  linhas_especificas <- row.names(filter(dados_combinados, abs(y1)>10))
  # Substitua os valores por NA nas linhas especificadas
  dados_combinados[linhas_especificas, ] <- replace(dados_combinados[linhas_especificas, ],
                                                    TRUE, NA)
  # Substituir NA pelo valor observado no mês anterior
  dados_combinados <- na.locf(dados_combinados, na.rm = FALSE)
  
  
  # Selecionar todas as colunas exceto a coluna de referência
  true_y1 <- dados_combinados[i, 1]
  true_colunas <- dados_combinados[1, -i]
  dados_combinados <- dados_combinados[-i,]
  resp <- dados_combinados %>% select(y1)
  colunas <- dados_combinados %>% select(-y1)
  # Executar prcomp para todas as colunas selecionadas
  resultado <- prcomp(colunas, scale = TRUE)
  var_explained = resultado$sdev^2 / sum(resultado$sdev^2)
  
  s = sum(cumsum(var_explained) <= 0.9)
  
  covariaveis <- as.matrix(colunas) %*%
    as.matrix(resultado$rotation[,c(1:s)])
  covariaveis <- data.frame(covariaveis)
  newdata = data.frame(cbind(resp, covariaveis))
  
  modelo <- lm(y1 ~ ., data = newdata)
  
  novo_caso <- as.matrix(true_colunas) %*%
    as.matrix(resultado$rotation[,c(1:s)])
  #Fazer a predicao usando o modelo ajustado
  predicao[i] <- (predict(modelo, newdata = data.frame(novo_caso)) - true_y1)**2
}
```



## R Markdown

This is an R Markdown document themed with [`{bslib}` package](https://rstudio.github.io/bslib/). `{bslib}` makes it easy to customize the main colors and fonts of a `html_document`, [`flexdashboard::flex_dashboard`](https://flexdashboard-pkg.netlify.app/articles/articles/theme.html), [shiny::fluidPage()](https://shiny.rstudio.com/reference/shiny/latest/fluidPage.html), or more generally any website that uses [Bootstrap](https://getbootstrap.com/) for styling. The `theme` parameter in the yaml front-matter of this Rmd document describes a [`bslib::bs_theme()`](https://rstudio.github.io/bslib/reference/bs_theme.html) object, which provides access to 100s of [theming options](https://rstudio.github.io/bslib/articles/bs5-variables.html) (via its `...` argument) in addition to the main options demonstrated here (e.g., `bg`, `fg`, `primary`, etc).

This particular example uses `{bslib}`'s default [Bootstrap version (which, at the time of writing, is Bootstrap 5)](https://rstudio.github.io/bslib/articles/bslib.html#versions). However, if reproducibility is important, it's recommended that you "lock-in" the version by adding `version: 5` to the `theme` definition.

## Themed Plots {.tabset .tabset-pills}

When running this document with [`{thematic}`](https://rstudio.github.io/thematic/) installed, the `thematic::thematic_rmd(font = "auto")` effectively translates `theme` (CSS) settings to new global theming defaults for `{ggplot2}`, `{lattice}`, and `{base}` R graphics:

### ggplot2

```{r}
library(ggplot2)

ggplot(mpg, aes(displ, hwy)) +
  geom_point() + geom_smooth()
```

### lattice

```{r}
lattice::show.settings()
```

### base

```{r}
plot(pressure, col = thematic::thematic_get_option("accent"))
```
